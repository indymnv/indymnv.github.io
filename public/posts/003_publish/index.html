<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content=""
  />
  
    
      <title>Using evotrees.jl for time series prediction | The Tarkus Factory</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  <link rel="stylesheet" href="/css/font.css"/>
  <link rel="stylesheet" href="/css/smigle.css"/>
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <div id="root">
      <header>
  <div id="brand">
    <a class="icon-link" href="https://smigle-hugo-theme.netlify.app/">
      <img
        class="icon"
        src="/images/brandIcon.svg"
      />
    </a>
    <div class="text">
      <a href="https://smigle-hugo-theme.netlify.app/"><h1>The Tarkus Factory</h1></a>
      <h3>Navi&#39;s Personal Blog</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/"><b>Home</b></a>
      
         | 
        <a href="/about/"><b>About</b></a>
      
         | 
        <a href="/posts/"><b>Posts</b></a>
      
         | 
        <a href="/categories/"><b>Categories</b></a>
      
         | 
        <a href="/tags/"><b>Tags</b></a>
      
         | 
        <a href="/index.xml"><b>RSS</b></a>
      
    
    
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: '\\[', right: '\\]', display: true},   
        {left: '$$', right: '$$', display: true},     
        {left: '\\(', right: '\\)', display: false},  
      ],
      throwOnError : false
    });
  });
</script>



  
  </nav>
  <hr />
</header>

      <div id="content">
        
  <main>
    <article>
      <h1 class="title">Using evotrees.jl for time series prediction</h1>
      
      <div class="post-meta">
  <strong>
    <span>Posted on</span>
    <time>2023-03-02</time>
    <span>in</span>
    
      <a href="/categories/programming">programming</a>, 
      <a href="/categories/quantitative-methods">quantitative methods</a>
  </strong>
  <span> • 2016 words</span>
  <span> • 10 minute read</span>
  
    <div>
      Last updated on
      <time>2024-03-16</time>
    </div>
  
  
    <div>
      <span>Tags:</span>
      
        <a href="/tags/julia">julia</a>, 
        <a href="/tags/data-science">data science</a>, 
        <a href="/tags/eda">eda</a>, 
        <a href="/tags/time-series">time series</a>
    </div>
  
</div>

      <div class="content"><h2 id="introduction">Introduction</h2>
<p>In this post, I want to show an analysis of a time series that I&rsquo;ve been working on. Usually, when dealing with time series, it is not so common to use machine learning algorithms (without at least trying more traditional models like the ARIMA family), but I still wanted to test how well a GBM model fits for these kinds of problems that are so popular.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> I don&rsquo;t recommend starting with models of this type for time series problems. There are simpler models to understand that are less computationally expensive.</p>
</blockquote>
<h2 id="dataset-preparation">Dataset Preparation</h2>
<h3 id="data-extraction">Data Extraction</h3>
<p>You can find the repository <a href="https://github.com/indymnv/Household-Electric-Power-Consumption">here</a>, The codes you will see here, I prototyped in <code>notebooks/tutorial.jl</code>.</p>
<p>Now we start by making the corresponding imports.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> DataFrames
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Plots
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> MLJ
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> EvoTrees
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> UrlDownload
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> ZipFile
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> HTTP
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> CSV
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Dates
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Statistics
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> MLJClusteringInterface
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Clustering
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> FreqTables
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> StatsPlots
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> RollingFunctions
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> StatsBase
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> ShiftedArrays
</span></span></code></pre></div><p>There are several libraries in this section, and I must admit it took me some time to use each one. But anyway to start reading the dataframe, we can get it directly from its repository.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>data_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://archive.ics.uci.edu/ml/machine-learning-databases/00235/household_power_consumption.zip&#34;</span>
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> download(data_url)
</span></span><span style="display:flex;"><span>z <span style="color:#f92672">=</span> ZipFile<span style="color:#f92672">.</span>Reader(f)
</span></span><span style="display:flex;"><span>z_by_filename <span style="color:#f92672">=</span> <span style="color:#66d9ef">Dict</span>( f<span style="color:#f92672">.</span>name <span style="color:#f92672">=&gt;</span> f <span style="color:#66d9ef">for</span> f <span style="color:#66d9ef">in</span> z<span style="color:#f92672">.</span>files)
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> CSV<span style="color:#f92672">.</span>read(z_by_filename[<span style="color:#e6db74">&#34;household_power_consumption.txt&#34;</span>], DataFrame,)
</span></span></code></pre></div><p>The dataframe looks more or less like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>     Row │ Date        Time      Global_active_power  Global_reactive_power  Voltage  Global_intensity  Sub_metering_1  Sub_metering_2  Sub_metering_3
</span></span><span style="display:flex;"><span>         │ String15    Time      String7              String7                String7  String7           String7         String7         <span style="color:#66d9ef">Float64</span><span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>─────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">1</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">24</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">4.216</span>                <span style="color:#ae81ff">0.418</span>                  <span style="color:#ae81ff">234.840</span>  <span style="color:#ae81ff">18.400</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">2</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">25</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">5.360</span>                <span style="color:#ae81ff">0.436</span>                  <span style="color:#ae81ff">233.630</span>  <span style="color:#ae81ff">23.000</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">16.0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">3</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">26</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">5.374</span>                <span style="color:#ae81ff">0.498</span>                  <span style="color:#ae81ff">233.290</span>  <span style="color:#ae81ff">23.000</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">2.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">4</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">27</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">5.388</span>                <span style="color:#ae81ff">0.502</span>                  <span style="color:#ae81ff">233.740</span>  <span style="color:#ae81ff">23.000</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">5</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">28</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">3.666</span>                <span style="color:#ae81ff">0.528</span>                  <span style="color:#ae81ff">235.680</span>  <span style="color:#ae81ff">15.800</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">6</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">29</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">3.520</span>                <span style="color:#ae81ff">0.522</span>                  <span style="color:#ae81ff">235.020</span>  <span style="color:#ae81ff">15.000</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">2.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">7</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">3.702</span>                <span style="color:#ae81ff">0.520</span>                  <span style="color:#ae81ff">235.090</span>  <span style="color:#ae81ff">15.800</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">8</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">31</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">3.700</span>                <span style="color:#ae81ff">0.520</span>                  <span style="color:#ae81ff">235.220</span>  <span style="color:#ae81ff">15.800</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">9</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">32</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">3.668</span>                <span style="color:#ae81ff">0.510</span>                  <span style="color:#ae81ff">233.990</span>  <span style="color:#ae81ff">15.800</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">10</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">33</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">3.662</span>                <span style="color:#ae81ff">0.510</span>                  <span style="color:#ae81ff">233.860</span>  <span style="color:#ae81ff">15.800</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">2.000</span>                     <span style="color:#ae81ff">16.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">11</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">34</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">4.448</span>                <span style="color:#ae81ff">0.498</span>                  <span style="color:#ae81ff">232.860</span>  <span style="color:#ae81ff">19.600</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">12</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">35</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">5.412</span>                <span style="color:#ae81ff">0.470</span>                  <span style="color:#ae81ff">232.780</span>  <span style="color:#ae81ff">23.200</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">13</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">36</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">5.224</span>                <span style="color:#ae81ff">0.478</span>                  <span style="color:#ae81ff">232.990</span>  <span style="color:#ae81ff">22.400</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                     <span style="color:#ae81ff">16.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">14</span> │ <span style="color:#ae81ff">16</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2006</span>  <span style="color:#ae81ff">17</span><span style="color:#f92672">:</span><span style="color:#ae81ff">37</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">5.268</span>                <span style="color:#ae81ff">0.398</span>                  <span style="color:#ae81ff">232.910</span>  <span style="color:#ae81ff">22.600</span>            <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">2.000</span>                     <span style="color:#ae81ff">17.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">⋮</span>    │     <span style="color:#f92672">⋮</span>          <span style="color:#f92672">⋮</span>               <span style="color:#f92672">⋮</span>                     <span style="color:#f92672">⋮</span>               <span style="color:#f92672">⋮</span>            <span style="color:#f92672">⋮</span>                <span style="color:#f92672">⋮</span>               <span style="color:#f92672">⋮</span>               <span style="color:#f92672">⋮</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075246</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">49</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.948</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">238.160</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075247</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">50</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">1.198</span>                <span style="color:#ae81ff">0.128</span>                  <span style="color:#ae81ff">238.110</span>  <span style="color:#ae81ff">5.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075248</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">51</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">1.024</span>                <span style="color:#ae81ff">0.106</span>                  <span style="color:#ae81ff">238.840</span>  <span style="color:#ae81ff">4.200</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">1.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075249</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">52</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.946</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">239.050</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075250</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">53</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.944</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">238.720</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075251</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">54</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.946</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">239.310</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075252</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">55</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.946</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">239.740</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075253</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">56</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.942</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">239.410</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075254</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">57</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.946</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">240.330</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075255</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">58</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.946</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">240.430</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075256</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">59</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.944</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">240.000</span>  <span style="color:#ae81ff">4.000</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075257</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">21</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.938</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">239.820</span>  <span style="color:#ae81ff">3.800</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075258</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">21</span><span style="color:#f92672">:</span><span style="color:#ae81ff">01</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.934</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">239.700</span>  <span style="color:#ae81ff">3.800</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">2075259</span> │ <span style="color:#ae81ff">26</span><span style="color:#f92672">/</span><span style="color:#ae81ff">11</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2010</span>  <span style="color:#ae81ff">21</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">0.932</span>                <span style="color:#ae81ff">0.000</span>                  <span style="color:#ae81ff">239.550</span>  <span style="color:#ae81ff">3.800</span>             <span style="color:#ae81ff">0.000</span>           <span style="color:#ae81ff">0.000</span>                      <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                                                                                                                                   <span style="color:#ae81ff">2075231</span> rows omitted
</span></span></code></pre></div><h3 id="dataset-cleaning">Dataset Cleaning</h3>
<p>As can be seen, it is a quite large dataset and we can take the opportunity to create new variables, so we have the possibility to obtain relevant information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#75715e">#Create a variable </span>
</span></span><span style="display:flex;"><span>date_time <span style="color:#f92672">=</span> [DateTime(d, t) <span style="color:#66d9ef">for</span> (d,t) <span style="color:#66d9ef">in</span> zip(data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">1</span>], data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">2</span>])]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>,<span style="color:#e6db74">:date_time</span>] <span style="color:#f92672">=</span> date_time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Create variable for date</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>,<span style="color:#e6db74">:year</span>] <span style="color:#f92672">=</span> Dates<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>(Year<span style="color:#f92672">.</span>(data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>,<span style="color:#e6db74">:month</span>] <span style="color:#f92672">=</span> Dates<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>(Month<span style="color:#f92672">.</span>(data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>,<span style="color:#e6db74">:day</span>] <span style="color:#f92672">=</span> Dates<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>(Day<span style="color:#f92672">.</span>(data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Create variable for time</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>, <span style="color:#e6db74">:hour</span>] <span style="color:#f92672">=</span> Dates<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>(Hour<span style="color:#f92672">.</span>(data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">2</span>]))
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>, <span style="color:#e6db74">:minute</span>] <span style="color:#f92672">=</span> Dates<span style="color:#f92672">.</span>value<span style="color:#f92672">.</span>(Minute<span style="color:#f92672">.</span>(data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">2</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Create variable for weekends</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>, <span style="color:#e6db74">:dayofweek</span>] <span style="color:#f92672">=</span> [dayofweek(date) <span style="color:#66d9ef">for</span> date <span style="color:#66d9ef">in</span> data<span style="color:#f92672">.</span>Date]
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>, <span style="color:#e6db74">:weekend</span>] <span style="color:#f92672">=</span> [day <span style="color:#66d9ef">in</span> [<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>] <span style="color:#66d9ef">for</span> day <span style="color:#66d9ef">in</span> data<span style="color:#f92672">.</span>dayofweek]
</span></span></code></pre></div><p>In addition, we notice that the variables are in String format. We can make some changes to put them in the appropriate form.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>    data[<span style="color:#f92672">!</span>,i] <span style="color:#f92672">=</span> parse<span style="color:#f92672">.</span>(<span style="color:#66d9ef">Float64</span>, data[<span style="color:#f92672">!</span>,i])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> replace<span style="color:#f92672">.</span>(data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;-&#34;</span>)
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> Date<span style="color:#f92672">.</span>(data[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#34;d-m-y&#34;</span>)
</span></span></code></pre></div><h2 id="preliminary-visualizations">Preliminary Visualizations</h2>
<p>A classic way to plot all the variables is with the following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>plot([plot(data[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">50000</span>, <span style="color:#e6db74">:date_time</span>],data[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">50000</span>,col]; label <span style="color:#f92672">=</span> col, xrot<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">for</span> col <span style="color:#66d9ef">in</span> [<span style="color:#e6db74">&#34;Global_active_power&#34;</span>,  <span style="color:#e6db74">&#34;Global_reactive_power&#34;</span>, <span style="color:#e6db74">&#34;Global_intensity&#34;</span>, <span style="color:#e6db74">&#34;Voltage&#34;</span>, <span style="color:#e6db74">&#34;Sub_metering_1&#34;</span>,  <span style="color:#e6db74">&#34;Sub_metering_2&#34;</span>, <span style="color:#e6db74">&#34;Sub_metering_3&#34;</span>]]<span style="color:#f92672">...</span>)
</span></span></code></pre></div><p><img src="/003_evotrees/lineplot_all.png" alt="Line Plot All"></p>
<p>Note that we only take a sample of 50,000 data points to avoid overloading the graphs with information, and in the same way, we can create histograms.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>plot([histogram(data[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">50000</span>, col],label <span style="color:#f92672">=</span> col, bins <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span> ) <span style="color:#66d9ef">for</span> col <span style="color:#66d9ef">in</span> [<span style="color:#e6db74">&#34;Global_active_power&#34;</span>,  <span style="color:#e6db74">&#34;Global_reactive_power&#34;</span>, <span style="color:#e6db74">&#34;Global_intensity&#34;</span>, <span style="color:#e6db74">&#34;Voltage&#34;</span>, <span style="color:#e6db74">&#34;Sub_metering_1&#34;</span>,  <span style="color:#e6db74">&#34;Sub_metering_2&#34;</span>, <span style="color:#e6db74">&#34;Sub_metering_3&#34;</span>]]<span style="color:#f92672">...</span>)
</span></span></code></pre></div><p><img src="/003_evotrees/all_hist.svg" alt="Line Plot All"></p>
<p>For now, we can recognize that the time series in its global variables have a white noise behavior, and Voltage also has it, however, it is the only one that seems to have a distribution that is similar to a normal distribution, while the sub-metering, are signs of use of household appliances.</p>
<h2 id="a-brief-clustering-with-kmeans">A brief clustering with kmeans</h2>
<p>In this section, we are interested in building a clustering model on the time series. The purpose? It is simply a way of evaluating behavior patterns over time, one hypothesis would be to see irregular behavior patterns over time, given that greater consumption would be seen at specific periods of the day or season.</p>
<p>An interesting issue that I was unaware of was that time series clustering is possible and you can use k-means, however in these cases, they cannot be treated from the same perspective, and other types of variants of these algorithms should be used to consider the temporality of neighboring observations when clustering. But since this project is just a toy, and the use of this technique is only for EDA, we will stick with the classical algorithm.</p>
<p>If you want to know more about this topic, yu can read this <a href="https://towardsdatascience.com/time-series-clustering-deriving-trends-and-archetypes-from-sequential-data-bb87783312b4">articule</a></p>
<p>Continuing with the problem, we can cluster by applying the following code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>X <span style="color:#f92672">=</span> data[<span style="color:#f92672">!</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>]
</span></span><span style="display:flex;"><span>transformer_instance <span style="color:#f92672">=</span> Standardizer()
</span></span><span style="display:flex;"><span>transformer_model <span style="color:#f92672">=</span> machine(transformer_instance, X)
</span></span><span style="display:flex;"><span>fit!(transformer_model)
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> MLJ<span style="color:#f92672">.</span>transform(transformer_model, X);
</span></span><span style="display:flex;"><span>KMeans<span style="color:#f92672">=</span> <span style="color:#a6e22e">@load</span> KMeans pkg<span style="color:#f92672">=</span>Clustering
</span></span><span style="display:flex;"><span>kmeans <span style="color:#f92672">=</span> KMeans(k<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mach <span style="color:#f92672">=</span> machine(kmeans, X) <span style="color:#f92672">|&gt;</span> fit!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cluster X into 3 clusters using K-means</span>
</span></span><span style="display:flex;"><span>Xsmall <span style="color:#f92672">=</span> MLJ<span style="color:#f92672">.</span>transform(mach);
</span></span><span style="display:flex;"><span>selectrows(Xsmall, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">|&gt;</span> pretty
</span></span><span style="display:flex;"><span>yhat <span style="color:#f92672">=</span> MLJ<span style="color:#f92672">.</span>predict(mach)
</span></span><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>,<span style="color:#e6db74">:cluster</span>] <span style="color:#f92672">=</span> yhat
</span></span></code></pre></div><p>In this case, we have 3 clusters that are ordered as follows.</p>
<pre tabindex="0"><code>cluster	nrow
CategoricalValue	Int64
1	1	741077
2	2	1257309
3	3	50894
</code></pre><p>And if we try to plot the clusters, we would have the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>plot([scatter(data[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20000</span>, <span style="color:#e6db74">:date_time</span>],data[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20000</span>,col]; group<span style="color:#f92672">=</span>data[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20000</span>,<span style="color:#f92672">:</span>]<span style="color:#f92672">.</span>cluster, size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">1200</span>, <span style="color:#ae81ff">1000</span>), title <span style="color:#f92672">=</span> col, xrot<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">for</span> col <span style="color:#66d9ef">in</span> [<span style="color:#e6db74">&#34;Global_active_power&#34;</span>,  <span style="color:#e6db74">&#34;Global_reactive_power&#34;</span>, <span style="color:#e6db74">&#34;Global_intensity&#34;</span>, <span style="color:#e6db74">&#34;Voltage&#34;</span>, <span style="color:#e6db74">&#34;Sub_metering_1&#34;</span>,  <span style="color:#e6db74">&#34;Sub_metering_2&#34;</span>, <span style="color:#e6db74">&#34;Sub_metering_3&#34;</span>]]<span style="color:#f92672">...</span>)
</span></span></code></pre></div><p><img src="/003_evotrees/cluster2.png" alt="scatter plot cluster"></p>
<p>It looks a bit confusing, although if we look at the voltage variable, we can already size up a certain trend. For now, let&rsquo;s consider a boxplot of the main variables but considering the clusters.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>b1 <span style="color:#f92672">=</span><span style="color:#a6e22e">@df</span> data boxplot(string<span style="color:#f92672">.</span>(<span style="color:#e6db74">:cluster</span>), <span style="color:#e6db74">:Global_active_power</span>, fillalpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.75</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, title <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Global active power&#34;</span>)
</span></span><span style="display:flex;"><span>b2 <span style="color:#f92672">=</span><span style="color:#a6e22e">@df</span> data boxplot(string<span style="color:#f92672">.</span>(<span style="color:#e6db74">:cluster</span>), <span style="color:#e6db74">:Global_reactive_power</span>, fillalpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.75</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Global reactive power&#34;</span>)
</span></span><span style="display:flex;"><span>b3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">@df</span> data boxplot(string<span style="color:#f92672">.</span>(<span style="color:#e6db74">:cluster</span>), <span style="color:#e6db74">:Global_intensity</span>, fillalpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.75</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, title <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Global intensity&#34;</span>)
</span></span><span style="display:flex;"><span>b4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">@df</span> data boxplot(string<span style="color:#f92672">.</span>(<span style="color:#e6db74">:cluster</span>), <span style="color:#e6db74">:Voltage</span>, fillalpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.75</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Voltage&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plot(b1, b2, b3, b4 ,layout<span style="color:#f92672">=</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>), legend<span style="color:#f92672">=</span>false)
</span></span></code></pre></div><p><img src="/003_evotrees/boxplotcluster.png" alt="scatter plot cluster"></p>
<p>The truth is that we notice slight differences between the clusters, where we have certain consumption patterns in each category, but in some of their variables these do not necessarily lead us to any conclusion. However, as we had mentioned at the beginning, the idea of ​​clustering was to study consumption patterns during time intervals, so we add the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>h1 <span style="color:#f92672">=</span>heatmap(freqtable(data,<span style="color:#e6db74">:cluster</span>,<span style="color:#e6db74">:dayofweek</span>)<span style="color:#f92672">./</span>freqtable(data,<span style="color:#e6db74">:cluster</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;day of week&#34;</span>)
</span></span><span style="display:flex;"><span>h2 <span style="color:#f92672">=</span>heatmap(freqtable(data,<span style="color:#e6db74">:cluster</span>,<span style="color:#e6db74">:hour</span>)<span style="color:#f92672">./</span>freqtable(data,<span style="color:#e6db74">:cluster</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hour&#34;</span>)
</span></span><span style="display:flex;"><span>h3 <span style="color:#f92672">=</span> heatmap(freqtable(data,<span style="color:#e6db74">:cluster</span>,<span style="color:#e6db74">:month</span>)<span style="color:#f92672">./</span>freqtable(data,<span style="color:#e6db74">:cluster</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;month&#34;</span>)
</span></span><span style="display:flex;"><span>h4 <span style="color:#f92672">=</span> heatmap(freqtable(data,<span style="color:#e6db74">:cluster</span>,<span style="color:#e6db74">:day</span>)<span style="color:#f92672">./</span>freqtable(data,<span style="color:#e6db74">:cluster</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;day&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plot(h1, h2, h3, h4 ,layout<span style="color:#f92672">=</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>), legend<span style="color:#f92672">=</span>false)
</span></span></code></pre></div><p><img src="/003_evotrees/diagram_time.svg" alt="scatter plot cluster"></p>
<p>It might be a bit confusing initially, but let me take an example that might help you understand. If you take into account cluster 2, it corresponds to the lowest use of the global intensity used. If we go to the heatmap that represents the hours, we will see that the time where this pattern of behavior is most present is at night, which corresponds to the hours we are usually sleeping. I hope this make more sense.</p>
<p>This might give us a slight hint that time frames might be necessary, we&rsquo;ll take this information for featuer engineering at this point later. Now let&rsquo;s start with the next phase.</p>
<h2 id="using-evotrees-for-prediction">Using EvoTrees for prediction.</h2>
<p>For now, we want to predict voltage. I&rsquo;m not an expert in the field of electricity and consumption, but for a simple exercise, we will use the MLJ library (for Python users it would be equivalent to Scikit-Learn). Due to the amount of data and the algorithm we are going to use, it is not practical to perform training with cross-validation, this will take too much time, so we will prefer to only use a train/test split as a strategy.</p>
<p>let&rsquo;s generate a lag and cut the data in the following way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>data[<span style="color:#f92672">!</span>, <span style="color:#e6db74">:lag_30</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">Array</span>(ShiftedArray(data<span style="color:#f92672">.</span>Voltage, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>replace!(data<span style="color:#f92672">.</span>lag_30, missing <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span></code></pre></div><p>And to assign the training and testing, we use the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>train <span style="color:#f92672">=</span> copy(filter(x <span style="color:#f92672">-&gt;</span> x<span style="color:#f92672">.</span>Date <span style="color:#f92672">&lt;</span> Date(<span style="color:#ae81ff">2010</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">01</span>), data))
</span></span><span style="display:flex;"><span>test <span style="color:#f92672">=</span> copy(filter(x <span style="color:#f92672">-&gt;</span> x<span style="color:#f92672">.</span>Date <span style="color:#f92672">&gt;=</span> Date(<span style="color:#ae81ff">2010</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">01</span>), data))
</span></span></code></pre></div><p>Then, we remove some variables that we won&rsquo;t use to train the model, and we save our voltage variable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>select!(train, Not([<span style="color:#e6db74">:Date</span>, <span style="color:#e6db74">:Time</span>, <span style="color:#e6db74">:date_time</span>, <span style="color:#e6db74">:cluster</span>, ]))
</span></span><span style="display:flex;"><span>select!(test, Not([<span style="color:#e6db74">:Date</span>, <span style="color:#e6db74">:Time</span>, <span style="color:#e6db74">:date_time</span>, <span style="color:#e6db74">:cluster</span>, ]))
</span></span><span style="display:flex;"><span>y_train <span style="color:#f92672">=</span> copy(train[<span style="color:#f92672">!</span>,<span style="color:#e6db74">:Voltage</span>])
</span></span><span style="display:flex;"><span>y_test <span style="color:#f92672">=</span> copy(test[<span style="color:#f92672">!</span>,<span style="color:#e6db74">:Voltage</span>])
</span></span></code></pre></div><p>Now we are going to apply a cyclical encoder to be able to work with the data, we have several new variables related to time (month, day, hour, among others), and all these variables will be more helpful if we allow extracting their cyclical character, that is why we use a trigonometric transformation</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> cyclical_encoder(df<span style="color:#f92672">::</span><span style="color:#66d9ef">DataFrame</span>, columns<span style="color:#f92672">::</span><span style="color:#66d9ef">Union</span>{<span style="color:#66d9ef">Array</span>, <span style="color:#66d9ef">Symbol</span>}, max_val<span style="color:#f92672">::</span><span style="color:#66d9ef">Union</span>{<span style="color:#66d9ef">Array</span>, <span style="color:#66d9ef">Int</span>} )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (column, max) <span style="color:#66d9ef">in</span> zip(columns, max_val)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        df[<span style="color:#f92672">:</span>, <span style="color:#66d9ef">Symbol</span>(string(column) <span style="color:#f92672">*</span> <span style="color:#e6db74">&#34;_sin&#34;</span>)] <span style="color:#f92672">=</span> sin<span style="color:#f92672">.</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>pi<span style="color:#f92672">*</span>df[<span style="color:#f92672">:</span>, column]<span style="color:#f92672">/</span>max)
</span></span><span style="display:flex;"><span>        df[<span style="color:#f92672">:</span>, <span style="color:#66d9ef">Symbol</span>(string(column) <span style="color:#f92672">*</span> <span style="color:#e6db74">&#34;_cos&#34;</span>)] <span style="color:#f92672">=</span> cos<span style="color:#f92672">.</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>pi<span style="color:#f92672">*</span>df[<span style="color:#f92672">:</span>, column]<span style="color:#f92672">/</span>max)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> df
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Finally, we can apply this new function to our dataset.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>columns_selected <span style="color:#f92672">=</span> [<span style="color:#e6db74">:day</span>, <span style="color:#e6db74">:year</span>, <span style="color:#e6db74">:month</span>, <span style="color:#e6db74">:hour</span>, <span style="color:#e6db74">:minute</span>, <span style="color:#e6db74">:dayofweek</span>]
</span></span><span style="display:flex;"><span>max_val <span style="color:#f92672">=</span> [<span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">2010</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">59</span>, <span style="color:#ae81ff">7</span>]
</span></span><span style="display:flex;"><span>train_cyclical <span style="color:#f92672">=</span> cyclical_encoder(train, columns_selected, max_val)
</span></span><span style="display:flex;"><span>test_cyclical <span style="color:#f92672">=</span> cyclical_encoder(test, columns_selected, max_val)
</span></span></code></pre></div><p>And finally, let&rsquo;s train the model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>EvoTreeRegressor <span style="color:#f92672">=</span> <span style="color:#a6e22e">@load</span> EvoTreeRegressor pkg<span style="color:#f92672">=</span>EvoTrees verbosity<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>etr_start <span style="color:#f92672">=</span> EvoTreeRegressor(max_depth <span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>machreg <span style="color:#f92672">=</span> machine(etr_start, train_cyclical[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">14</span><span style="color:#f92672">:</span><span style="color:#66d9ef">end</span>], y_train);
</span></span><span style="display:flex;"><span>fit!(machreg);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pred_etr_train <span style="color:#f92672">=</span> MLJ<span style="color:#f92672">.</span>predict(machreg, train_cyclical[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">14</span><span style="color:#f92672">:</span><span style="color:#66d9ef">end</span>]);
</span></span><span style="display:flex;"><span>rms_score_train <span style="color:#f92672">=</span> rms(pred_etr_train, y_train)
</span></span><span style="display:flex;"><span>println(<span style="color:#e6db74">&#34;The rms in train is </span><span style="color:#e6db74">$rms_score_train</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pred_etr <span style="color:#f92672">=</span> MLJ<span style="color:#f92672">.</span>predict(machreg, test_cyclical[<span style="color:#f92672">!</span>,<span style="color:#ae81ff">14</span><span style="color:#f92672">:</span><span style="color:#66d9ef">end</span>]);
</span></span><span style="display:flex;"><span>rms_score <span style="color:#f92672">=</span> rms(pred_etr, y_test)
</span></span><span style="display:flex;"><span>println(<span style="color:#e6db74">&#34;The rms in test is </span><span style="color:#e6db74">$rms_score</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p>This is our result:</p>
<ul>
<li>The rms in train is 2.5364451392238085</li>
<li>The rms in test is 3.438565163838837</li>
</ul>
<p>In this section, we plot the residual left by our model, and here we can detect some signs of overfitting, considering that our model has a much better score in the training dataset than in the test dataset. On the other hand, the plots are showing us that our model has biases in its predictions, it is not being able to recognize trends.</p>
<p><img src="/003_evotrees/predictions.svg" alt="prediction"></p>
<p>Finally, we can see how the predictions compare to the test data.</p>
<p><img src="/003_evotrees/pred_vs_real.png" alt="pred-vs-real"></p>
<p>As we have confirmed earlier, the prediction does not seem to have been able to determine the magnitudes of the voltage in the testing of the dataset. Despite the fact that our variable is fairly stable over time, the model was trained with different parameters, but ultimately none of the options managed to show a significant improvement.</p>
<h2 id="conclusions">Conclusions</h2>
<p>With this small exercise, we only tried to test that GBM, while a powerful tool and popular in places like Kaggle, requires a certain level of expertise both in the model and in the use case to achieve good performance. A naive approach may not generate results that satisfy the users. This, on one hand, requires:</p>
<ol>
<li>Understanding how to perform feature engineering for a time series, such as obtaining the decomposition of the time series. This can help capture trends that cannot always be obtained solely with the time horizon.</li>
<li>Applying smoothing strategies like moving averages could help recognize the underlying pattern, but then you will need to estimate that moving average into the future.</li>
</ol>
<p>Overall, time series analysis requires a deep understanding of the data, proper preprocessing techniques, feature engineering, and selecting appropriate models that can capture the specific patterns and dynamics of the data.</p>
</div>
    </article>
  </main>

<section class="webring">
  <h3>Articles from blogs I follow around the net</h3>
  <section class="articles">
    
    <div class="article">
      <h4 class="title" dir="auto">
        <a href="https://dm13450.github.io/2024/03/09/Calibrating-an-Ornstein-Uhlenbeck-Process.html" target="_blank" rel="noopener">Calibrating an Ornstein–Uhlenbeck Process</a>
      </h4>
      <p class="summary" dir="auto">Read enough quant finance papers or books and you’ll come across the Ornstein–Uhlenbeck (OU) process. This is a post that explores the OU process, the equations, how we can simulate such a process and then estimate the parameters.</p>
      <small class="source">
        via <a href="https://dm13450.github.io/">Dean Markwick</a>
      </small>
      <small class="date">March 9, 2024</small>
    </div>
    
    <div class="article">
      <h4 class="title" dir="auto">
        <a href="https://jarbus.net/blog/zen-in-the-art-of-beat-saber/" target="_blank" rel="noopener">Zen in the Art of Beat Saber</a>
      </h4>
      <p class="summary" dir="auto">Contents: Introduction, Step away, come back later, Focus, but not too much, Generalization comes after specialization, Don’t bother if you don’t need to, Let Go
Introduction

    
        
    

I recently read Zen in the Art of Archery, which isn’t a book abou…</p>
      <small class="source">
        via <a href="https://jarbus.net/">jarbus.net on </a>
      </small>
      <small class="date">February 22, 2024</small>
    </div>
    
    <div class="article">
      <h4 class="title" dir="auto">
        <a href="https://drewdevault.com/2023/12/26/2023-12-26-Prusa-is-floundering.html" target="_blank" rel="noopener">Why Prusa is floundering, and how you can avoid their fate</a>
      </h4>
      <p class="summary" dir="auto">Prusa is a 3D printer manufacturer which has a long history of being admired by
the 3D printing community for high quality, open source printers. They have been
struggling as of late, and came under criticism for making the firmware of their
Mk4 printer non-…</p>
      <small class="source">
        via <a href="https://drewdevault.com">Drew DeVault&#39;s blog</a>
      </small>
      <small class="date">December 26, 2023</small>
    </div>
    
  </section>
  <p class="attribution">
    Generated by
    <a href="https://git.sr.ht/~sircmpwn/openring">openring</a>
  </p>
</section>
<style>
.webring .articles {
  display: flex;
  flex-wrap: wrap;
  margin: -0.5rem;
}
.webring .title {
  margin: 0;
}
.webring .article {
  flex: 1 1 0;
  display: flex;
  flex-direction: column;
  margin: 0.5rem;
  padding: 0.5rem;
  background: #3c3836;
  min-width: 10rem;
}
.webring .summary {
  font-size: 0.8rem;
  flex: 1 1 0;
}
.webring .attribution {
  text-align: right;
  font-size: 0.8rem;
  color: #555;
}
</style>


      </div>
      <footer>
  <hr />
  
    <p id="social">
      Find me around the web:
      <br />
      
        
        <a href="https://github.com/indymnv">GitHub</a>
      
         | 
        <a href="https://codeberg.org/indymnv">Codeberg</a>
      
         | 
        <a href="https://fosstodon.org/@indymnv">Mastodon</a>
      
         | 
        <a href="https://matrix.to/#/@navi93:matrix.org">Matrix</a>
      
    </p>
  
  <p class="copyright">
    Copyright © 2024
    <a href="https://smigle-hugo-theme.netlify.app/"><strong>Navi</strong></a>.
    This work is licensed under the
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.
  </p>
  <p class="builtWith">
    Built with
    <a href="http://www.gohugo.io/">Hugo</a>,
    using the theme
    <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>,
    which was influenced by the theme
    <a href="https://github.com/sumnerevans/smol">smol</a>.
  </p>
</footer>

    </div>
  </body>
</html>
